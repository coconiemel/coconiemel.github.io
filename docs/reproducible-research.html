<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Reproducible Research | portfolio_book.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Reproducible Research | portfolio_book.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Reproducible Research | portfolio_book.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="index.html"/>
<link rel="next" href="data-management.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="form.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<div class="title">Portfolio of Coco Niemel</div>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Curriculum Vitae</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#education"><i class="fa fa-check"></i>Education</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#professional-experience"><i class="fa fa-check"></i>Professional Experience</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i>Skills</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#languages"><i class="fa fa-check"></i>Languages</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="reproducible-research.html"><a href="reproducible-research.html"><i class="fa fa-check"></i><b>1</b> Reproducible Research</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-research.html"><a href="reproducible-research.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="reproducible-research.html"><a href="reproducible-research.html#analyse-an-excel-file"><i class="fa fa-check"></i>Analyse an excel file</a></li>
<li class="chapter" data-level="" data-path="reproducible-research.html"><a href="reproducible-research.html#scoring-reproducibility"><i class="fa fa-check"></i>Scoring reproducibility</a></li>
<li class="chapter" data-level="" data-path="reproducible-research.html"><a href="reproducible-research.html#usage-of-other-peoples-codes"><i class="fa fa-check"></i>Usage of other peoples codes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-management.html"><a href="data-management.html"><i class="fa fa-check"></i><b>2</b> Data management</a>
<ul>
<li class="chapter" data-level="" data-path="data-management.html"><a href="data-management.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="data-management.html"><a href="data-management.html#my-execution"><i class="fa fa-check"></i>My execution</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html"><i class="fa fa-check"></i><b>3</b> A phylogenetic analysis</a>
<ul>
<li class="chapter" data-level="" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html#introduction-2"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html#plan"><i class="fa fa-check"></i>Plan</a></li>
<li class="chapter" data-level="" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html#the-filoviridae-family"><i class="fa fa-check"></i>The Filoviridae family</a></li>
<li class="chapter" data-level="" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html#the-phylogenetic-tree"><i class="fa fa-check"></i>The phylogenetic tree</a></li>
<li class="chapter" data-level="" data-path="a-phylogenetic-analysis.html"><a href="a-phylogenetic-analysis.html#future-steps"><i class="fa fa-check"></i>Future steps</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="group-project.html"><a href="group-project.html"><i class="fa fa-check"></i><b>4</b> Group project</a>
<ul>
<li class="chapter" data-level="" data-path="group-project.html"><a href="group-project.html#introduction-3"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="group-project.html"><a href="group-project.html#ontox"><i class="fa fa-check"></i>ONTOX</a></li>
<li class="chapter" data-level="" data-path="group-project.html"><a href="group-project.html#our-addition"><i class="fa fa-check"></i>Our addition</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html"><i class="fa fa-check"></i><b>5</b> Relational data and databases</a>
<ul>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#introduction-4"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#dbeaver-connection"><i class="fa fa-check"></i>DBeaver connection</a></li>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#inspection"><i class="fa fa-check"></i>Inspection</a></li>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive statistics</a></li>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#visualisations"><i class="fa fa-check"></i>Visualisations</a>
<ul>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#flu"><i class="fa fa-check"></i>Flu</a></li>
<li class="chapter" data-level="" data-path="relational-data-and-databases.html"><a href="relational-data-and-databases.html#dengue"><i class="fa fa-check"></i>Dengue</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="r-package.html"><a href="r-package.html"><i class="fa fa-check"></i><b>6</b> R package</a>
<ul>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#introduction-5"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#copopa"><i class="fa fa-check"></i>Copopa</a>
<ul>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#multi_check"><i class="fa fa-check"></i>multi_check()</a></li>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#mima"><i class="fa fa-check"></i>mima()</a></li>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#mean_sd"><i class="fa fa-check"></i>mean_sd()</a></li>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#save_to_csv_rds"><i class="fa fa-check"></i>save_to_csv_rds()</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-package.html"><a href="r-package.html#install-and-load"><i class="fa fa-check"></i>Install and load</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rmarkdown-parameters.html"><a href="rmarkdown-parameters.html"><i class="fa fa-check"></i><b>7</b> RMarkdown parameters</a>
<ul>
<li class="chapter" data-level="" data-path="rmarkdown-parameters.html"><a href="rmarkdown-parameters.html#introduction-6"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-parameters.html"><a href="rmarkdown-parameters.html#data-inspection"><i class="fa fa-check"></i>Data inspection</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-parameters.html"><a href="rmarkdown-parameters.html#building-a-parametrised-graph"><i class="fa fa-check"></i>Building a parametrised graph</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-parameters.html"><a href="rmarkdown-parameters.html#alter-parameter-settings"><i class="fa fa-check"></i>Alter parameter settings</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reproducible-research" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Reproducible Research</h1>
<div id="introduction" class="section level2 unnumbered">
<h2>Introduction</h2>
<p>During this assignment I learned to search, analyse and use different types of reproducible data.</p>
<hr />
</div>
<div id="analyse-an-excel-file" class="section level2 unnumbered">
<h2>Analyse an excel file</h2>
<p>The experiment used for this analysis was obtained from an experiment in which adult <em>C. elegans</em> was exposed to varying concentrations of different compounds. The data for this experiment is supplied by J. Louter (INT/ILC).</p>
<p>The experiment contains a Excel file called CE.LIQ.FLOW.062_Tidydata.xlsx. During analysing this file I noticed that under ‘compVehicle’ the negative and positive seems to be alike, apart from the concentration. Negative is a higher concentration with ethanol and positive is a lower concentration with a variation of things.
The summary of the file tells the positive control is ethanol and the negative control is S medium.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="reproducible-research.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain file in environment</span></span>
<span id="cb1-2"><a href="reproducible-research.html#cb1-2" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span> <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;files/CE.LIQ.FLOW.062_Tidydata.xlsx&quot;</span>) </span></code></pre></div>
<p>After import in R I checked the datatypes, but these were not assigned correctly.
RawData is numeric, but should be integer, because it contains full numbers.
CompName is character, but should be factor, because the names can be changed with numbers and get sorted by.
CompConcentration is character, but should be numeric, because it contains decimals.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="reproducible-research.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check datatype</span></span>
<span id="cb2-2"><a href="reproducible-research.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multi_check</span>(CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>RawData, CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compName, CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compConcentration)</span></code></pre></div>
<p>To keep working with the file, I changed the datatypes to the correct ones.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="reproducible-research.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into integer datatype.</span></span>
<span id="cb3-2"><a href="reproducible-research.html#cb3-2" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>RawData <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>RawData)</span>
<span id="cb3-3"><a href="reproducible-research.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="reproducible-research.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into factor.</span></span>
<span id="cb3-5"><a href="reproducible-research.html#cb3-5" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compName <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compName)</span>
<span id="cb3-6"><a href="reproducible-research.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="reproducible-research.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into double (numeric value).</span></span>
<span id="cb3-8"><a href="reproducible-research.html#cb3-8" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compConcentration <span class="ot">&lt;-</span> <span class="fu">as.double</span>(CE.LIQ.FLOW<span class="fl">.062</span><span class="sc">$</span>compConcentration)</span></code></pre></div>
<p>After this plotting was possible. The scatterplot shows the log10 of the concentration of different compounds in the <em>C. elegans</em> offspring count.
The correction with log10 was necessary because the labels of the x-axis were overlapping each other, the values had a large number of decimals and were randomly positioned.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="reproducible-research.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain needed columns</span></span>
<span id="cb4-2"><a href="reproducible-research.html#cb4-2" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span>_summary <span class="ot">&lt;-</span> CE.LIQ.FLOW<span class="fl">.062</span> <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="reproducible-research.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(compName, compConcentration, expType) <span class="sc">%&gt;%</span>                          </span>
<span id="cb4-4"><a href="reproducible-research.html#cb4-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">summarize</span>(<span class="at">mean_counts =</span> <span class="fu">mean</span>(RawData, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-5"><a href="reproducible-research.html#cb4-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">sd_counts =</span>  <span class="fu">sd</span>(RawData, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),)</span>
<span id="cb4-6"><a href="reproducible-research.html#cb4-6" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span>_summary_tbl <span class="ot">&lt;-</span> CE.LIQ.FLOW<span class="fl">.062</span>_summary <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="reproducible-research.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(expType <span class="sc">==</span> <span class="st">&quot;experiment&quot;</span>)</span>
<span id="cb4-8"><a href="reproducible-research.html#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="reproducible-research.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatterplot</span></span>
<span id="cb4-10"><a href="reproducible-research.html#cb4-10" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span>_summary_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(compConcentration), </span>
<span id="cb4-11"><a href="reproducible-research.html#cb4-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">y =</span> mean_counts)) <span class="sc">+</span></span>
<span id="cb4-12"><a href="reproducible-research.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> compName, <span class="at">shape =</span> expType), <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb4-13"><a href="reproducible-research.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">seed =</span> <span class="dv">123</span>)) <span class="sc">+</span></span>
<span id="cb4-14"><a href="reproducible-research.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean_counts<span class="sc">-</span>sd_counts, <span class="at">ymax=</span>mean_counts<span class="sc">+</span>sd_counts, </span>
<span id="cb4-15"><a href="reproducible-research.html#cb4-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> compName), <span class="at">width=</span> <span class="fl">0.2</span>, </span>
<span id="cb4-16"><a href="reproducible-research.html#cb4-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">seed =</span> <span class="dv">123</span>))<span class="sc">+</span></span>
<span id="cb4-17"><a href="reproducible-research.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Mean counts C. elegans offspring in various concentrations&quot;</span>,</span>
<span id="cb4-18"><a href="reproducible-research.html#cb4-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Log10 of compound concentration&quot;</span>,</span>
<span id="cb4-19"><a href="reproducible-research.html#cb4-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;C. elegans offspring count&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="reproducible-research.html#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) </span></code></pre></div>
<p><img src="portfolio_book_files/figure-html/create%20plot-1.png" width="672" /></p>
<p><em>Figure 1: Scatterplot of C. elegans offspring counts.</em></p>
<p>For further analysing of the effect I would start by testing normality by performing a Shapiro-Wilk test. If unusual, I would normalise the data, if normal, I would start an ANOVA between de different conditions. I would end with the post-hoc tests, to check in what combination of groups the difference is.</p>
<p>In this case, the data is not normal, so normalising is necessary.
The normalising step is to see if the offspring count increases or decreases relatively to the negative control and if so, if there is anything influenced by the negative control.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="reproducible-research.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Viewing CE.LIQ.FLOW.062_summary shows the mean value of controlNegative = 85.9.</span></span>
<span id="cb5-2"><a href="reproducible-research.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="reproducible-research.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the column with normalised average counts</span></span>
<span id="cb5-4"><a href="reproducible-research.html#cb5-4" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span>_summary_norm <span class="ot">&lt;-</span> CE.LIQ.FLOW<span class="fl">.062</span>_summary_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="reproducible-research.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm_counts =</span> mean_counts<span class="sc">/</span><span class="fl">85.9</span>, <span class="at">norm_sd =</span> sd_counts<span class="sc">/</span><span class="fl">85.9</span>)</span>
<span id="cb5-6"><a href="reproducible-research.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="reproducible-research.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatterplot with normalised data</span></span>
<span id="cb5-8"><a href="reproducible-research.html#cb5-8" aria-hidden="true" tabindex="-1"></a>CE.LIQ.FLOW<span class="fl">.062</span>_summary_norm <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(compConcentration), </span>
<span id="cb5-9"><a href="reproducible-research.html#cb5-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">y =</span> norm_counts)) <span class="sc">+</span></span>
<span id="cb5-10"><a href="reproducible-research.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> compName, <span class="at">shape =</span> expType), <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb5-11"><a href="reproducible-research.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">seed =</span> <span class="dv">150</span>)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="reproducible-research.html#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>norm_counts<span class="sc">-</span>norm_sd, <span class="at">ymax=</span>norm_counts<span class="sc">+</span>norm_sd, </span>
<span id="cb5-13"><a href="reproducible-research.html#cb5-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> compName), <span class="at">width=</span> <span class="fl">0.2</span>, </span>
<span id="cb5-14"><a href="reproducible-research.html#cb5-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">seed =</span> <span class="dv">150</span>))<span class="sc">+</span></span>
<span id="cb5-15"><a href="reproducible-research.html#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Mean counts C. elegans offspring in various concentrations&quot;</span>,</span>
<span id="cb5-16"><a href="reproducible-research.html#cb5-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;normalised to negative control = 1&quot;</span>,</span>
<span id="cb5-17"><a href="reproducible-research.html#cb5-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Log10 of compound concentration&quot;</span>,</span>
<span id="cb5-18"><a href="reproducible-research.html#cb5-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;C. elegans offspring count&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="reproducible-research.html#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) </span></code></pre></div>
<p><img src="portfolio_book_files/figure-html/normalise%20data-1.png" width="672" /></p>
<p><em>Figure 2: Normalised scatterplot of C. elegans offspring counts.</em></p>
<hr />
</div>
<div id="scoring-reproducibility" class="section level2 unnumbered">
<h2>Scoring reproducibility</h2>
<p>The next analysis is based on an article that addresses if meaningless novel words in linguistic contexts can achieve emotional connotations and whether these connotations can affect the quality of word learning and retention <span class="citation">(<a href="references.html#ref-snefjellaHowEmotionLearned2020" role="doc-biblioref">Snefjella, Lana, and Kuperman 2020</a>)</span>.</p>
<p>There is a lot of language research concerning the human capacity for learning new words, though this research is by far not complete yet. Because of that, the goal of this paper is to add to this research field.</p>
<p>To answer these questions, five experiments were set up. Three groups of L1 speakers of the English language had to learn nine novel words in a consistently positive, neutral or negative context. During the learning phase, reading times were recorded. Immediately after and one week after, vocabulary post-test were administered to assess learning and retention.</p>
<p>The results showed that for both research questions two out of three groups learned the forms, definitional meanings and emotional connotations and that de positive group learned the best out of the three groups.</p>
<p>The analysis is a scoring on the basis of the <a href="https://www.researchgate.net/publication/340244621_Reproducibility_and_reporting_practices_in_COVID-19_preprint_manuscripts">Repita transparency criteria</a>. This is a method for identifying reproducibility issues in a scientific publication <span class="citation">(<a href="references.html#ref-sumnerReproducibilityReportingPractices2020" role="doc-biblioref">Sumner et al. 2020</a>)</span>. The scoring is shown below, the definitions can be found in the link above.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="reproducible-research.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create matrix</span></span>
<span id="cb6-2"><a href="reproducible-research.html#cb6-2" aria-hidden="true" tabindex="-1"></a>repita_criteria_tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">&quot;Study purpose&quot;</span>, <span class="st">&quot;V&quot;</span>, <span class="st">&quot;Data availability statement&quot;</span>, <span class="st">&quot;V&quot;</span>, <span class="st">&quot;Data location&quot;</span>, <span class="st">&quot;[Available here](https://osf.io/yghx3/)&quot;</span>, <span class="st">&quot;Study location&quot;</span>, <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;Author review&quot;</span>, <span class="st">&quot;[Bottom of page](https://www.sciencedirect.com/science/article/abs/pii/S0749596X20300851?via%3Dihub)&quot;</span>, <span class="st">&quot;Ethics statement&quot;</span>, <span class="st">&quot;V&quot;</span>, <span class="st">&quot;Funding statement&quot;</span>, <span class="st">&quot;V&quot;</span>, <span class="st">&quot;Code availability&quot;</span>, <span class="st">&quot;X&quot;</span>), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="reproducible-research.html#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="reproducible-research.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define names of matrix</span></span>
<span id="cb6-5"><a href="reproducible-research.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(repita_criteria_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Transparency criteria&#39;</span>, <span class="st">&#39;Score&#39;</span>)</span>
<span id="cb6-6"><a href="reproducible-research.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="reproducible-research.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert matrix to table </span></span>
<span id="cb6-8"><a href="reproducible-research.html#cb6-8" aria-hidden="true" tabindex="-1"></a>repita_criteria_tab <span class="ot">&lt;-</span> <span class="fu">as.table</span>(repita_criteria_tab)</span>
<span id="cb6-9"><a href="reproducible-research.html#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="reproducible-research.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Design and view table </span></span>
<span id="cb6-11"><a href="reproducible-research.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(repita_criteria_tab, <span class="at">caption =</span> <span class="st">&quot;Table 1: The Repita criteria with answers concerning the article above.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">&quot;striped&quot;</span>, <span class="at">full_width =</span> F)</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
(#tab:repita scoring table)Table 1: The Repita criteria with answers concerning the article above.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Transparency criteria
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Study purpose
</td>
<td style="text-align:left;">
V
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
Data availability statement
</td>
<td style="text-align:left;">
V
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
Data location
</td>
<td style="text-align:left;">
<a href="https://osf.io/yghx3/">Available here</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
Study location
</td>
<td style="text-align:left;">
USA
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:left;">
Author review
</td>
<td style="text-align:left;">
<a href="https://www.sciencedirect.com/science/article/abs/pii/S0749596X20300851?via%3Dihub">Bottom of page</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
Ethics statement
</td>
<td style="text-align:left;">
V
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
Funding statement
</td>
<td style="text-align:left;">
V
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Code availability
</td>
<td style="text-align:left;">
X
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="usage-of-other-peoples-codes" class="section level2 unnumbered">
<h2>Usage of other peoples codes</h2>
<p>The last analysis contains a code of an article about the case-fatality rate of COVID-19 <span class="citation">(<a href="references.html#ref-dudelMonitoringTrendsDifferences2020" role="doc-biblioref">Dudel et al. 2020</a>)</span>.</p>
<p>Looking at the code, is seems to achieve a visualisation of the differences in case-fatality rate (CFR) over time in between countries, using the age structure of infection and age specific CFRs. This is done by creating tables containing the latest data of diagnosed cases and death counts (concerning COVID-19) for each country.</p>
<p>The readability of the code is quite al right. The code in general is readable and understandable because of comments and different chuncks. But the total code is quite long and stored in different files, which makes it a little bit harder to access and run.</p>
<p>After trying the code myself the code was a little less accessible than I thought. At first it took a lot of effort, because the file in the url didn’t exist any more and I couldn’t figure out the updated pathway. The updated pathway was not clearly indicated, but once I found it the reproduction was pretty smooth and I only had to make small changes.</p>
<p>The full code is stated below, showing comments of changes I made to make it run.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="reproducible-research.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Case fatality rate #######################################################</span></span>
<span id="cb7-2"><a href="reproducible-research.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="reproducible-research.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cc = case-age distribution</span></span>
<span id="cb7-4"><a href="reproducible-research.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rr = age-specific case fatality rates</span></span>
<span id="cb7-5"><a href="reproducible-research.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  cfr <span class="ot">&lt;-</span> <span class="cf">function</span>(cc,rr){</span>
<span id="cb7-6"><a href="reproducible-research.html#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(cc <span class="sc">*</span> rr)</span>
<span id="cb7-7"><a href="reproducible-research.html#cb7-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-8"><a href="reproducible-research.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="reproducible-research.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-10"><a href="reproducible-research.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">### Kitagawa decomposition ####################################################</span></span>
<span id="cb7-11"><a href="reproducible-research.html#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="reproducible-research.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c1 = Age distribution population 1</span></span>
<span id="cb7-13"><a href="reproducible-research.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># r1 = Case fatality rates population 1</span></span>
<span id="cb7-14"><a href="reproducible-research.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c2 = Age distribution population 2</span></span>
<span id="cb7-15"><a href="reproducible-research.html#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># r2 = Case fatality rates population 2</span></span>
<span id="cb7-16"><a href="reproducible-research.html#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="reproducible-research.html#cb7-17" aria-hidden="true" tabindex="-1"></a>  kitagawa_cfr <span class="ot">&lt;-</span> <span class="cf">function</span>(c1, r1, c2, r2){</span>
<span id="cb7-18"><a href="reproducible-research.html#cb7-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-19"><a href="reproducible-research.html#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age-distribution of cases</span></span>
<span id="cb7-20"><a href="reproducible-research.html#cb7-20" aria-hidden="true" tabindex="-1"></a>    c1  <span class="ot">&lt;-</span> c1 <span class="sc">/</span> <span class="fu">sum</span>(c1)</span>
<span id="cb7-21"><a href="reproducible-research.html#cb7-21" aria-hidden="true" tabindex="-1"></a>    c2  <span class="ot">&lt;-</span> c2 <span class="sc">/</span> <span class="fu">sum</span>(c2)</span>
<span id="cb7-22"><a href="reproducible-research.html#cb7-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-23"><a href="reproducible-research.html#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total difference</span></span>
<span id="cb7-24"><a href="reproducible-research.html#cb7-24" aria-hidden="true" tabindex="-1"></a>    Tot <span class="ot">&lt;-</span> <span class="fu">cfr</span>(c1, r1) <span class="sc">-</span> <span class="fu">cfr</span>(c2, r2)</span>
<span id="cb7-25"><a href="reproducible-research.html#cb7-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-26"><a href="reproducible-research.html#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age component</span></span>
<span id="cb7-27"><a href="reproducible-research.html#cb7-27" aria-hidden="true" tabindex="-1"></a>    Aa  <span class="ot">&lt;-</span> <span class="fu">sum</span>((c1 <span class="sc">-</span> c2) <span class="sc">*</span> (r1 <span class="sc">+</span> r2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb7-28"><a href="reproducible-research.html#cb7-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-29"><a href="reproducible-research.html#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Case fatality component</span></span>
<span id="cb7-30"><a href="reproducible-research.html#cb7-30" aria-hidden="true" tabindex="-1"></a>    Bb  <span class="ot">&lt;-</span> <span class="fu">sum</span>((r1 <span class="sc">-</span> r2) <span class="sc">*</span> (c1 <span class="sc">+</span> c2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb7-31"><a href="reproducible-research.html#cb7-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-32"><a href="reproducible-research.html#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output</span></span>
<span id="cb7-33"><a href="reproducible-research.html#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">Diff =</span> Tot, </span>
<span id="cb7-34"><a href="reproducible-research.html#cb7-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">AgeComp =</span> Aa,</span>
<span id="cb7-35"><a href="reproducible-research.html#cb7-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">RateComp =</span> Bb, </span>
<span id="cb7-36"><a href="reproducible-research.html#cb7-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">CFR1 =</span> <span class="fu">weighted.mean</span>(r1,c1), </span>
<span id="cb7-37"><a href="reproducible-research.html#cb7-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">CFR2 =</span> <span class="fu">weighted.mean</span>(r2,c2))</span>
<span id="cb7-38"><a href="reproducible-research.html#cb7-38" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="reproducible-research.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This whole chunck doesn&#39;t work anymore because the file in the url has been deleted by the owner. Instead of this file, a file in the given data, named &quot;inputdata.csv&quot;, will be used. Because of this, the chunck will not be executed (eval = false).</span></span>
<span id="cb8-2"><a href="reproducible-research.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="reproducible-research.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Required packages</span></span>
<span id="cb8-4"><a href="reproducible-research.html#cb8-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">source</span>((<span class="st">&quot;00_functions.R&quot;</span>))</span>
<span id="cb8-5"><a href="reproducible-research.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="reproducible-research.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># URL + filename</span></span>
<span id="cb8-7"><a href="reproducible-research.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="st">&#39;https://osf.io/wu5ve//?action=download&#39;</span></span>
<span id="cb8-8"><a href="reproducible-research.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="st">&#39;Data/Output_10.csv&#39;</span></span>
<span id="cb8-9"><a href="reproducible-research.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="reproducible-research.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb8-11"><a href="reproducible-research.html#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GET</span>(url, <span class="fu">write_disk</span>(filename, <span class="at">overwrite =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-12"><a href="reproducible-research.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filename,<span class="at">skip=</span><span class="dv">3</span>)</span>
<span id="cb8-13"><a href="reproducible-research.html#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="reproducible-research.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="reproducible-research.html#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">### Edit data (select countries, etc.) ########################################</span></span>
<span id="cb8-16"><a href="reproducible-research.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="reproducible-research.html#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lists of countries and regions</span></span>
<span id="cb8-18"><a href="reproducible-research.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  countrylist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;Germany&quot;</span>,<span class="st">&quot;Italy&quot;</span>,<span class="st">&quot;South Korea&quot;</span>,<span class="st">&quot;Spain&quot;</span>,<span class="st">&quot;USA&quot;</span>)</span>
<span id="cb8-19"><a href="reproducible-research.html#cb8-19" aria-hidden="true" tabindex="-1"></a>  region <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;All&quot;</span>,<span class="st">&quot;NYC&quot;</span>)</span>
<span id="cb8-20"><a href="reproducible-research.html#cb8-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-21"><a href="reproducible-research.html#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb8-22"><a href="reproducible-research.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist <span class="sc">&amp;</span> Region <span class="sc">%in%</span> region)</span>
<span id="cb8-23"><a href="reproducible-research.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-24"><a href="reproducible-research.html#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove Tests variable</span></span>
<span id="cb8-25"><a href="reproducible-research.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tests=</span><span class="cn">NULL</span>)</span>
<span id="cb8-26"><a href="reproducible-research.html#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="reproducible-research.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop if no cases/Deaths</span></span>
<span id="cb8-28"><a href="reproducible-research.html#cb8-28" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat)</span>
<span id="cb8-29"><a href="reproducible-research.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="reproducible-research.html#cb8-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-31"><a href="reproducible-research.html#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="do">### Save ######################################################################</span></span>
<span id="cb8-32"><a href="reproducible-research.html#cb8-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-33"><a href="reproducible-research.html#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(dat,<span class="at">path=</span><span class="st">&quot;Data/inputdata.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="reproducible-research.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Load functions &amp; packages #################################################</span></span>
<span id="cb9-2"><a href="reproducible-research.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="reproducible-research.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Not necessary anymore, all the libraries are stored together above.</span></span>
<span id="cb9-4"><a href="reproducible-research.html#cb9-4" aria-hidden="true" tabindex="-1"></a> <span class="do">## source((&quot;00_functions.R&quot;)) </span></span>
<span id="cb9-5"><a href="reproducible-research.html#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="reproducible-research.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="reproducible-research.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Load and edit data ########################################################</span></span>
<span id="cb9-8"><a href="reproducible-research.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="reproducible-research.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load CSV file</span></span>
<span id="cb9-10"><a href="reproducible-research.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;files/COVID_article/inputdata.csv&quot;</span>)</span>
<span id="cb9-11"><a href="reproducible-research.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="reproducible-research.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set Date as date</span></span>
<span id="cb9-13"><a href="reproducible-research.html#cb9-13" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dat<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb9-14"><a href="reproducible-research.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="reproducible-research.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find max dates</span></span>
<span id="cb9-16"><a href="reproducible-research.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  maxdates <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="reproducible-research.html#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="reproducible-research.html#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">maxdate=</span><span class="fu">max</span>(Date))</span>
<span id="cb9-19"><a href="reproducible-research.html#cb9-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="reproducible-research.html#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get least common denominator</span></span>
<span id="cb9-21"><a href="reproducible-research.html#cb9-21" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> maxdates <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="reproducible-research.html#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Country<span class="sc">!=</span><span class="st">&quot;China&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="reproducible-research.html#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-24"><a href="reproducible-research.html#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">min</span>(maxdate))</span>
<span id="cb9-25"><a href="reproducible-research.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-26"><a href="reproducible-research.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># As vector</span></span>
<span id="cb9-27"><a href="reproducible-research.html#cb9-27" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(maxdate)[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb9-28"><a href="reproducible-research.html#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="reproducible-research.html#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="reproducible-research.html#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="do">### Numbers for Table 1 #######################################################</span></span>
<span id="cb9-31"><a href="reproducible-research.html#cb9-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-32"><a href="reproducible-research.html#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Latest date: maxdate</span></span>
<span id="cb9-33"><a href="reproducible-research.html#cb9-33" aria-hidden="true" tabindex="-1"></a>  refdate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb9-34"><a href="reproducible-research.html#cb9-34" aria-hidden="true" tabindex="-1"></a>  dat2 <span class="ot">&lt;-</span> dat  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="co">#maxdate</span></span>
<span id="cb9-35"><a href="reproducible-research.html#cb9-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-36"><a href="reproducible-research.html#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate case and death counts</span></span>
<span id="cb9-37"><a href="reproducible-research.html#cb9-37" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Cases<span class="sc">~</span>Code<span class="sc">+</span>Date<span class="sc">+</span>Country<span class="sc">+</span>Region,<span class="at">data=</span>dat2[dat2<span class="sc">$</span>Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>,],sum) </span>
<span id="cb9-38"><a href="reproducible-research.html#cb9-38" aria-hidden="true" tabindex="-1"></a>  deaths <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Deaths<span class="sc">~</span>Code<span class="sc">+</span>Date<span class="sc">+</span>Country<span class="sc">+</span>Region,<span class="at">data=</span>dat2[dat2<span class="sc">$</span>Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>,],sum)</span>
<span id="cb9-39"><a href="reproducible-research.html#cb9-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-40"><a href="reproducible-research.html#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Most recent counts</span></span>
<span id="cb9-41"><a href="reproducible-research.html#cb9-41" aria-hidden="true" tabindex="-1"></a>  cases <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb9-42"><a href="reproducible-research.html#cb9-42" aria-hidden="true" tabindex="-1"></a>  deaths <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb9-43"><a href="reproducible-research.html#cb9-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="reproducible-research.html#cb9-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-45"><a href="reproducible-research.html#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="do">### Analysis for Table 2 (and appendix) #######################################</span></span>
<span id="cb9-46"><a href="reproducible-research.html#cb9-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-47"><a href="reproducible-research.html#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ASFRs</span></span>
<span id="cb9-48"><a href="reproducible-research.html#cb9-48" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ascfr =</span> Deaths <span class="sc">/</span> Cases,</span>
<span id="cb9-49"><a href="reproducible-research.html#cb9-49" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">replace_na</span>(ascfr, <span class="dv">0</span>))</span>
<span id="cb9-50"><a href="reproducible-research.html#cb9-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-51"><a href="reproducible-research.html#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get codes for reference countries</span></span>
<span id="cb9-52"><a href="reproducible-research.html#cb9-52" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> <span class="fu">format.Date</span>(maxdate,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb9-53"><a href="reproducible-research.html#cb9-53" aria-hidden="true" tabindex="-1"></a>  refdate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb9-54"><a href="reproducible-research.html#cb9-54" aria-hidden="true" tabindex="-1"></a>  refdate2 <span class="ot">&lt;-</span> <span class="fu">format.Date</span>(refdate,<span class="st">&quot;%d.%m.%Y&quot;</span>)<span class="co">#maxdate</span></span>
<span id="cb9-55"><a href="reproducible-research.html#cb9-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-56"><a href="reproducible-research.html#cb9-56" aria-hidden="true" tabindex="-1"></a>  DE_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;DE_&quot;</span>,refdate2)<span class="co">#paste0(&quot;DE_&quot;,maxdate)</span></span>
<span id="cb9-57"><a href="reproducible-research.html#cb9-57" aria-hidden="true" tabindex="-1"></a>  IT_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;ITbol&quot;</span>,refdate2)<span class="co">#paste0(&quot;ITinfo&quot;,maxdate)</span></span>
<span id="cb9-58"><a href="reproducible-research.html#cb9-58" aria-hidden="true" tabindex="-1"></a>  SK_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;KR&quot;</span>,refdate2)<span class="co">#paste0(&quot;SK&quot;,maxdate)</span></span>
<span id="cb9-59"><a href="reproducible-research.html#cb9-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-60"><a href="reproducible-research.html#cb9-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decide some reference patterns (For main text: SK)</span></span>
<span id="cb9-61"><a href="reproducible-research.html#cb9-61" aria-hidden="true" tabindex="-1"></a>  DE <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-62"><a href="reproducible-research.html#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> DE_code,</span>
<span id="cb9-63"><a href="reproducible-research.html#cb9-63" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-64"><a href="reproducible-research.html#cb9-64" aria-hidden="true" tabindex="-1"></a>  IT <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-65"><a href="reproducible-research.html#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> IT_code,</span>
<span id="cb9-66"><a href="reproducible-research.html#cb9-66" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-67"><a href="reproducible-research.html#cb9-67" aria-hidden="true" tabindex="-1"></a>  SK <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-68"><a href="reproducible-research.html#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> SK_code,</span>
<span id="cb9-69"><a href="reproducible-research.html#cb9-69" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-70"><a href="reproducible-research.html#cb9-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-71"><a href="reproducible-research.html#cb9-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decompose</span></span>
<span id="cb9-72"><a href="reproducible-research.html#cb9-72" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-73"><a href="reproducible-research.html#cb9-73" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(DE<span class="sc">$</span>Cases, DE<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb9-74"><a href="reproducible-research.html#cb9-74" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex, Region)]</span>
<span id="cb9-75"><a href="reproducible-research.html#cb9-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-76"><a href="reproducible-research.html#cb9-76" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-77"><a href="reproducible-research.html#cb9-77" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(IT<span class="sc">$</span>Cases, IT<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb9-78"><a href="reproducible-research.html#cb9-78" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex,Region)]</span>
<span id="cb9-79"><a href="reproducible-research.html#cb9-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-80"><a href="reproducible-research.html#cb9-80" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-81"><a href="reproducible-research.html#cb9-81" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(SK<span class="sc">$</span>Cases, SK<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb9-82"><a href="reproducible-research.html#cb9-82" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex,Region)]</span>
<span id="cb9-83"><a href="reproducible-research.html#cb9-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-84"><a href="reproducible-research.html#cb9-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only most recent date, both genders combined</span></span>
<span id="cb9-85"><a href="reproducible-research.html#cb9-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-86"><a href="reproducible-research.html#cb9-86" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb9-87"><a href="reproducible-research.html#cb9-87" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb9-88"><a href="reproducible-research.html#cb9-88" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb9-89"><a href="reproducible-research.html#cb9-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-90"><a href="reproducible-research.html#cb9-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop unnecessary variables</span></span>
<span id="cb9-91"><a href="reproducible-research.html#cb9-91" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb9-92"><a href="reproducible-research.html#cb9-92" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb9-93"><a href="reproducible-research.html#cb9-93" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb9-94"><a href="reproducible-research.html#cb9-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-95"><a href="reproducible-research.html#cb9-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate relative contributions</span></span>
<span id="cb9-96"><a href="reproducible-research.html#cb9-96" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-97"><a href="reproducible-research.html#cb9-97" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-98"><a href="reproducible-research.html#cb9-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-99"><a href="reproducible-research.html#cb9-99" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeIT =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-100"><a href="reproducible-research.html#cb9-100" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateIT =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-101"><a href="reproducible-research.html#cb9-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-102"><a href="reproducible-research.html#cb9-102" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeSK =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-103"><a href="reproducible-research.html#cb9-103" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateSK =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-104"><a href="reproducible-research.html#cb9-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-105"><a href="reproducible-research.html#cb9-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb9-106"><a href="reproducible-research.html#cb9-106" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffDE=</span>Diff,<span class="at">AgeCompDE=</span>AgeComp,<span class="at">RateCompDE=</span>RateComp)</span>
<span id="cb9-107"><a href="reproducible-research.html#cb9-107" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffIT=</span>Diff,<span class="at">AgeCompIT=</span>AgeComp,<span class="at">RateCompIT=</span>RateComp)</span>
<span id="cb9-108"><a href="reproducible-research.html#cb9-108" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffSK=</span>Diff,<span class="at">AgeCompSK=</span>AgeComp,<span class="at">RateCompSK=</span>RateComp)</span>
<span id="cb9-109"><a href="reproducible-research.html#cb9-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-110"><a href="reproducible-research.html#cb9-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb9-111"><a href="reproducible-research.html#cb9-111" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb9-112"><a href="reproducible-research.html#cb9-112" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb9-113"><a href="reproducible-research.html#cb9-113" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Table 2</span></span>
<span id="cb9-114"><a href="reproducible-research.html#cb9-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-115"><a href="reproducible-research.html#cb9-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-116"><a href="reproducible-research.html#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="do">### Table 3: Italy trend ######################################################</span></span>
<span id="cb9-117"><a href="reproducible-research.html#cb9-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-118"><a href="reproducible-research.html#cb9-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Italy trend</span></span>
<span id="cb9-119"><a href="reproducible-research.html#cb9-119" aria-hidden="true" tabindex="-1"></a>  ITtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-120"><a href="reproducible-research.html#cb9-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;ITbol09.03.2020&quot;</span>,</span>
<span id="cb9-121"><a href="reproducible-research.html#cb9-121" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-122"><a href="reproducible-research.html#cb9-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-123"><a href="reproducible-research.html#cb9-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb9-124"><a href="reproducible-research.html#cb9-124" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-125"><a href="reproducible-research.html#cb9-125" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,ITtrend<span class="sc">$</span>Cases, ITtrend<span class="sc">$</span>ascfr),</span>
<span id="cb9-126"><a href="reproducible-research.html#cb9-126" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb9-127"><a href="reproducible-research.html#cb9-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-128"><a href="reproducible-research.html#cb9-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Italy</span></span>
<span id="cb9-129"><a href="reproducible-research.html#cb9-129" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Italy&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb9-130"><a href="reproducible-research.html#cb9-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-131"><a href="reproducible-research.html#cb9-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb9-132"><a href="reproducible-research.html#cb9-132" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb9-133"><a href="reproducible-research.html#cb9-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-134"><a href="reproducible-research.html#cb9-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb9-135"><a href="reproducible-research.html#cb9-135" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-136"><a href="reproducible-research.html#cb9-136" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-137"><a href="reproducible-research.html#cb9-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-138"><a href="reproducible-research.html#cb9-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb9-139"><a href="reproducible-research.html#cb9-139" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb9-140"><a href="reproducible-research.html#cb9-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-141"><a href="reproducible-research.html#cb9-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb9-142"><a href="reproducible-research.html#cb9-142" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb9-143"><a href="reproducible-research.html#cb9-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-144"><a href="reproducible-research.html#cb9-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-145"><a href="reproducible-research.html#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="do">### Appendix: Trends USA/Spain ################################################</span></span>
<span id="cb9-146"><a href="reproducible-research.html#cb9-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-147"><a href="reproducible-research.html#cb9-147" aria-hidden="true" tabindex="-1"></a>  <span class="do">### NYC trend</span></span>
<span id="cb9-148"><a href="reproducible-research.html#cb9-148" aria-hidden="true" tabindex="-1"></a>  NYtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-149"><a href="reproducible-research.html#cb9-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;US_NYC22.03.2020&quot;</span>,</span>
<span id="cb9-150"><a href="reproducible-research.html#cb9-150" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-151"><a href="reproducible-research.html#cb9-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-152"><a href="reproducible-research.html#cb9-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb9-153"><a href="reproducible-research.html#cb9-153" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-154"><a href="reproducible-research.html#cb9-154" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,NYtrend<span class="sc">$</span>Cases, NYtrend<span class="sc">$</span>ascfr),</span>
<span id="cb9-155"><a href="reproducible-research.html#cb9-155" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Region,Code, Date, Sex)]</span>
<span id="cb9-156"><a href="reproducible-research.html#cb9-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-157"><a href="reproducible-research.html#cb9-157" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only NYC</span></span>
<span id="cb9-158"><a href="reproducible-research.html#cb9-158" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span> <span class="sc">&amp;</span> Region<span class="sc">==</span><span class="st">&quot;NYC&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb9-159"><a href="reproducible-research.html#cb9-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-160"><a href="reproducible-research.html#cb9-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb9-161"><a href="reproducible-research.html#cb9-161" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb9-162"><a href="reproducible-research.html#cb9-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-163"><a href="reproducible-research.html#cb9-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb9-164"><a href="reproducible-research.html#cb9-164" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-165"><a href="reproducible-research.html#cb9-165" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-166"><a href="reproducible-research.html#cb9-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-167"><a href="reproducible-research.html#cb9-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb9-168"><a href="reproducible-research.html#cb9-168" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb9-169"><a href="reproducible-research.html#cb9-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-170"><a href="reproducible-research.html#cb9-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb9-171"><a href="reproducible-research.html#cb9-171" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb9-172"><a href="reproducible-research.html#cb9-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-173"><a href="reproducible-research.html#cb9-173" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Spain trend</span></span>
<span id="cb9-174"><a href="reproducible-research.html#cb9-174" aria-hidden="true" tabindex="-1"></a>  EStrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-175"><a href="reproducible-research.html#cb9-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;ES21.03.2020&quot;</span>,</span>
<span id="cb9-176"><a href="reproducible-research.html#cb9-176" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-177"><a href="reproducible-research.html#cb9-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-178"><a href="reproducible-research.html#cb9-178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb9-179"><a href="reproducible-research.html#cb9-179" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-180"><a href="reproducible-research.html#cb9-180" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,EStrend<span class="sc">$</span>Cases, EStrend<span class="sc">$</span>ascfr),</span>
<span id="cb9-181"><a href="reproducible-research.html#cb9-181" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb9-182"><a href="reproducible-research.html#cb9-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-183"><a href="reproducible-research.html#cb9-183" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Spain</span></span>
<span id="cb9-184"><a href="reproducible-research.html#cb9-184" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Spain&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb9-185"><a href="reproducible-research.html#cb9-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-186"><a href="reproducible-research.html#cb9-186" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb9-187"><a href="reproducible-research.html#cb9-187" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb9-188"><a href="reproducible-research.html#cb9-188" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-189"><a href="reproducible-research.html#cb9-189" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb9-190"><a href="reproducible-research.html#cb9-190" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-191"><a href="reproducible-research.html#cb9-191" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-192"><a href="reproducible-research.html#cb9-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-193"><a href="reproducible-research.html#cb9-193" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb9-194"><a href="reproducible-research.html#cb9-194" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb9-195"><a href="reproducible-research.html#cb9-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-196"><a href="reproducible-research.html#cb9-196" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb9-197"><a href="reproducible-research.html#cb9-197" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb9-198"><a href="reproducible-research.html#cb9-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-199"><a href="reproducible-research.html#cb9-199" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Germany trend</span></span>
<span id="cb9-200"><a href="reproducible-research.html#cb9-200" aria-hidden="true" tabindex="-1"></a>  DEtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-201"><a href="reproducible-research.html#cb9-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;DE_21.03.2020&quot;</span>,</span>
<span id="cb9-202"><a href="reproducible-research.html#cb9-202" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb9-203"><a href="reproducible-research.html#cb9-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-204"><a href="reproducible-research.html#cb9-204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb9-205"><a href="reproducible-research.html#cb9-205" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb9-206"><a href="reproducible-research.html#cb9-206" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,DEtrend<span class="sc">$</span>Cases, DEtrend<span class="sc">$</span>ascfr),</span>
<span id="cb9-207"><a href="reproducible-research.html#cb9-207" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb9-208"><a href="reproducible-research.html#cb9-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-209"><a href="reproducible-research.html#cb9-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Germany</span></span>
<span id="cb9-210"><a href="reproducible-research.html#cb9-210" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Germany&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span> <span class="sc">&amp;</span> Date<span class="sc">&gt;=</span><span class="st">&quot;2020-03-21&quot;</span>) </span>
<span id="cb9-211"><a href="reproducible-research.html#cb9-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-212"><a href="reproducible-research.html#cb9-212" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb9-213"><a href="reproducible-research.html#cb9-213" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb9-214"><a href="reproducible-research.html#cb9-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-215"><a href="reproducible-research.html#cb9-215" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb9-216"><a href="reproducible-research.html#cb9-216" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-217"><a href="reproducible-research.html#cb9-217" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb9-218"><a href="reproducible-research.html#cb9-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-219"><a href="reproducible-research.html#cb9-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb9-220"><a href="reproducible-research.html#cb9-220" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb9-221"><a href="reproducible-research.html#cb9-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-222"><a href="reproducible-research.html#cb9-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb9-223"><a href="reproducible-research.html#cb9-223" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb9-224"><a href="reproducible-research.html#cb9-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-225"><a href="reproducible-research.html#cb9-225" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-226"><a href="reproducible-research.html#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="do">### Save results ##############################################################</span></span>
<span id="cb9-227"><a href="reproducible-research.html#cb9-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-228"><a href="reproducible-research.html#cb9-228" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Table 2</span></span>
<span id="cb9-229"><a href="reproducible-research.html#cb9-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecSK,</span>
<span id="cb9-230"><a href="reproducible-research.html#cb9-230" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/Table2.xlsx&quot;</span>)</span>
<span id="cb9-231"><a href="reproducible-research.html#cb9-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-232"><a href="reproducible-research.html#cb9-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Table 3</span></span>
<span id="cb9-233"><a href="reproducible-research.html#cb9-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecITtrend,</span>
<span id="cb9-234"><a href="reproducible-research.html#cb9-234" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/Table3.xlsx&quot;</span>)</span>
<span id="cb9-235"><a href="reproducible-research.html#cb9-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-236"><a href="reproducible-research.html#cb9-236" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 1</span></span>
<span id="cb9-237"><a href="reproducible-research.html#cb9-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDE,</span>
<span id="cb9-238"><a href="reproducible-research.html#cb9-238" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab1.xlsx&quot;</span>)</span>
<span id="cb9-239"><a href="reproducible-research.html#cb9-239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-240"><a href="reproducible-research.html#cb9-240" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 2</span></span>
<span id="cb9-241"><a href="reproducible-research.html#cb9-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecIT,</span>
<span id="cb9-242"><a href="reproducible-research.html#cb9-242" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab2.xlsx&quot;</span>)</span>
<span id="cb9-243"><a href="reproducible-research.html#cb9-243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-244"><a href="reproducible-research.html#cb9-244" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 3</span></span>
<span id="cb9-245"><a href="reproducible-research.html#cb9-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecNYtrend,</span>
<span id="cb9-246"><a href="reproducible-research.html#cb9-246" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab3.xlsx&quot;</span>)</span>
<span id="cb9-247"><a href="reproducible-research.html#cb9-247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-248"><a href="reproducible-research.html#cb9-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 4</span></span>
<span id="cb9-249"><a href="reproducible-research.html#cb9-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecEStrend,</span>
<span id="cb9-250"><a href="reproducible-research.html#cb9-250" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab4.xlsx&quot;</span>)</span>
<span id="cb9-251"><a href="reproducible-research.html#cb9-251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-252"><a href="reproducible-research.html#cb9-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 5</span></span>
<span id="cb9-253"><a href="reproducible-research.html#cb9-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDEtrend,</span>
<span id="cb9-254"><a href="reproducible-research.html#cb9-254" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab5.xlsx&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="reproducible-research.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Load functions &amp; packages #################################################</span></span>
<span id="cb10-2"><a href="reproducible-research.html#cb10-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-3"><a href="reproducible-research.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Not necessary anymore, all the libraries are stored together above. </span></span>
<span id="cb10-4"><a href="reproducible-research.html#cb10-4" aria-hidden="true" tabindex="-1"></a> <span class="do">## source((&quot;00_functions.R&quot;))</span></span>
<span id="cb10-5"><a href="reproducible-research.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-6"><a href="reproducible-research.html#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="reproducible-research.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Load case data ############################################################</span></span>
<span id="cb10-8"><a href="reproducible-research.html#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="reproducible-research.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb10-10"><a href="reproducible-research.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;files/COVID_article/inputdata.csv&quot;</span>)</span>
<span id="cb10-11"><a href="reproducible-research.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="reproducible-research.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit date</span></span>
<span id="cb10-13"><a href="reproducible-research.html#cb10-13" aria-hidden="true" tabindex="-1"></a>  cases<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(cases<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb10-14"><a href="reproducible-research.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-15"><a href="reproducible-research.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lists of countries and regions</span></span>
<span id="cb10-16"><a href="reproducible-research.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  countrylist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;Germany&quot;</span>,<span class="st">&quot;Italy&quot;</span>,<span class="st">&quot;South Korea&quot;</span>,<span class="st">&quot;Spain&quot;</span>,<span class="st">&quot;USA&quot;</span>)</span>
<span id="cb10-17"><a href="reproducible-research.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  regionlist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;All&quot;</span>)</span>
<span id="cb10-18"><a href="reproducible-research.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="reproducible-research.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb10-20"><a href="reproducible-research.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist <span class="sc">&amp;</span> Region <span class="sc">%in%</span> regionlist)</span>
<span id="cb10-21"><a href="reproducible-research.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-22"><a href="reproducible-research.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop tests</span></span>
<span id="cb10-23"><a href="reproducible-research.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tests=</span><span class="cn">NULL</span>)</span>
<span id="cb10-24"><a href="reproducible-research.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="reproducible-research.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-26"><a href="reproducible-research.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="do">### Load and edit excess mortality data #######################################</span></span>
<span id="cb10-27"><a href="reproducible-research.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-28"><a href="reproducible-research.html#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load CSV file</span></span>
<span id="cb10-29"><a href="reproducible-research.html#cb10-29" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;files/COVID_article/baseline_excess_pclm_5.csv&quot;</span>)</span>
<span id="cb10-30"><a href="reproducible-research.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-31"><a href="reproducible-research.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set Date as date</span></span>
<span id="cb10-32"><a href="reproducible-research.html#cb10-32" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dat<span class="sc">$</span>date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb10-33"><a href="reproducible-research.html#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="reproducible-research.html#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb10-35"><a href="reproducible-research.html#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb10-36"><a href="reproducible-research.html#cb10-36" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist) <span class="sc">%&gt;%</span> </span>
<span id="cb10-37"><a href="reproducible-research.html#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> <span class="st">&quot;2020-02-24&quot;</span>)</span>
<span id="cb10-38"><a href="reproducible-research.html#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="reproducible-research.html#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="reproducible-research.html#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Analysis similar to Table 2 ###############################################</span></span>
<span id="cb10-41"><a href="reproducible-research.html#cb10-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-42"><a href="reproducible-research.html#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate cumulative excess deaths</span></span>
<span id="cb10-43"><a href="reproducible-research.html#cb10-43" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a href="reproducible-research.html#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">exc_p =</span> <span class="fu">ifelse</span>(excess <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, excess)) <span class="sc">%&gt;%</span></span>
<span id="cb10-45"><a href="reproducible-research.html#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country,Age,Sex) <span class="sc">%&gt;%</span> </span>
<span id="cb10-46"><a href="reproducible-research.html#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Exc =</span> <span class="fu">cumsum</span>(exc_p)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb10-47"><a href="reproducible-research.html#cb10-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-48"><a href="reproducible-research.html#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit age variable</span></span>
<span id="cb10-49"><a href="reproducible-research.html#cb10-49" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">recode</span>(Age,</span>
<span id="cb10-50"><a href="reproducible-research.html#cb10-50" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;5&#39;</span><span class="ot">=</span><span class="dv">0</span>,</span>
<span id="cb10-51"><a href="reproducible-research.html#cb10-51" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;15&#39;</span><span class="ot">=</span><span class="dv">10</span>,</span>
<span id="cb10-52"><a href="reproducible-research.html#cb10-52" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;25&#39;</span><span class="ot">=</span><span class="dv">20</span>,</span>
<span id="cb10-53"><a href="reproducible-research.html#cb10-53" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;35&#39;</span><span class="ot">=</span><span class="dv">30</span>,</span>
<span id="cb10-54"><a href="reproducible-research.html#cb10-54" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;45&#39;</span><span class="ot">=</span><span class="dv">40</span>,</span>
<span id="cb10-55"><a href="reproducible-research.html#cb10-55" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;55&#39;</span><span class="ot">=</span><span class="dv">50</span>,</span>
<span id="cb10-56"><a href="reproducible-research.html#cb10-56" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;65&#39;</span><span class="ot">=</span><span class="dv">60</span>,</span>
<span id="cb10-57"><a href="reproducible-research.html#cb10-57" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;75&#39;</span><span class="ot">=</span><span class="dv">70</span>,</span>
<span id="cb10-58"><a href="reproducible-research.html#cb10-58" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;85&#39;</span><span class="ot">=</span><span class="dv">80</span>,</span>
<span id="cb10-59"><a href="reproducible-research.html#cb10-59" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;95&#39;</span><span class="ot">=</span><span class="dv">90</span>))</span>
<span id="cb10-60"><a href="reproducible-research.html#cb10-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-61"><a href="reproducible-research.html#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate</span></span>
<span id="cb10-62"><a href="reproducible-research.html#cb10-62" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Sex,Date,Age,Week) <span class="sc">%&gt;%</span> </span>
<span id="cb10-63"><a href="reproducible-research.html#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Exc) <span class="sc">%&gt;%</span> <span class="fu">summarize_all</span>(sum)</span>
<span id="cb10-64"><a href="reproducible-research.html#cb10-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-65"><a href="reproducible-research.html#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust date for US: case countrs from two days earlier than excess mortality</span></span>
<span id="cb10-66"><a href="reproducible-research.html#cb10-66" aria-hidden="true" tabindex="-1"></a>  cases<span class="sc">$</span>Date[cases<span class="sc">$</span>Date<span class="sc">==</span><span class="st">&quot;2020-05-23&quot;</span> <span class="sc">&amp;</span> cases<span class="sc">$</span>Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;2020-05-25&quot;</span></span>
<span id="cb10-67"><a href="reproducible-research.html#cb10-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-68"><a href="reproducible-research.html#cb10-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge with cases</span></span>
<span id="cb10-69"><a href="reproducible-research.html#cb10-69" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(dat,cases[,<span class="fu">c</span>(<span class="st">&quot;Country&quot;</span>,<span class="st">&quot;Date&quot;</span>,<span class="st">&quot;Age&quot;</span>,<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Cases&quot;</span>)])</span>
<span id="cb10-70"><a href="reproducible-research.html#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="reproducible-research.html#cb10-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ASFRs</span></span>
<span id="cb10-72"><a href="reproducible-research.html#cb10-72" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ascfr =</span> Exc <span class="sc">/</span> Cases,</span>
<span id="cb10-73"><a href="reproducible-research.html#cb10-73" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">replace_na</span>(ascfr, <span class="dv">0</span>),</span>
<span id="cb10-74"><a href="reproducible-research.html#cb10-74" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(ascfr),<span class="dv">0</span>,ascfr),</span>
<span id="cb10-75"><a href="reproducible-research.html#cb10-75" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">ifelse</span>(ascfr<span class="sc">&gt;</span><span class="dv">1</span>,<span class="dv">1</span>,ascfr))</span>
<span id="cb10-76"><a href="reproducible-research.html#cb10-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-77"><a href="reproducible-research.html#cb10-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decide some reference patterns (here Germany)</span></span>
<span id="cb10-78"><a href="reproducible-research.html#cb10-78" aria-hidden="true" tabindex="-1"></a>  DE <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb10-79"><a href="reproducible-research.html#cb10-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;Germany&quot;</span>,</span>
<span id="cb10-80"><a href="reproducible-research.html#cb10-80" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb10-81"><a href="reproducible-research.html#cb10-81" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Date == maxdate)</span></span>
<span id="cb10-82"><a href="reproducible-research.html#cb10-82" aria-hidden="true" tabindex="-1"></a>           Week <span class="sc">==</span> <span class="dv">19</span>)</span>
<span id="cb10-83"><a href="reproducible-research.html#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="reproducible-research.html#cb10-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-85"><a href="reproducible-research.html#cb10-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decompose</span></span>
<span id="cb10-86"><a href="reproducible-research.html#cb10-86" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb10-87"><a href="reproducible-research.html#cb10-87" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(DE<span class="sc">$</span>Cases, DE<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb10-88"><a href="reproducible-research.html#cb10-88" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country,Week, Sex)]</span>
<span id="cb10-89"><a href="reproducible-research.html#cb10-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-90"><a href="reproducible-research.html#cb10-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only most recent date, both genders combined</span></span>
<span id="cb10-91"><a href="reproducible-research.html#cb10-91" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Week <span class="sc">%in%</span> <span class="dv">19</span><span class="sc">:</span><span class="dv">22</span>)</span>
<span id="cb10-92"><a href="reproducible-research.html#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="reproducible-research.html#cb10-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop unnecessary variables</span></span>
<span id="cb10-94"><a href="reproducible-research.html#cb10-94" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Week,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb10-95"><a href="reproducible-research.html#cb10-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-96"><a href="reproducible-research.html#cb10-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate relative contributions</span></span>
<span id="cb10-97"><a href="reproducible-research.html#cb10-97" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb10-98"><a href="reproducible-research.html#cb10-98" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb10-99"><a href="reproducible-research.html#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="reproducible-research.html#cb10-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb10-101"><a href="reproducible-research.html#cb10-101" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffDE=</span>Diff,<span class="at">AgeCompDE=</span>AgeComp,<span class="at">RateCompDE=</span>RateComp)</span>
<span id="cb10-102"><a href="reproducible-research.html#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="reproducible-research.html#cb10-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb10-104"><a href="reproducible-research.html#cb10-104" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb10-105"><a href="reproducible-research.html#cb10-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-106"><a href="reproducible-research.html#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-107"><a href="reproducible-research.html#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="do">### Save extra table ##########################################################</span></span>
<span id="cb10-108"><a href="reproducible-research.html#cb10-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-109"><a href="reproducible-research.html#cb10-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 1</span></span>
<span id="cb10-110"><a href="reproducible-research.html#cb10-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDE,</span>
<span id="cb10-111"><a href="reproducible-research.html#cb10-111" aria-hidden="true" tabindex="-1"></a>            <span class="at">path=</span><span class="st">&quot;files/COVID_article/AppendixTab6.xlsx&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="reproducible-research.html#cb11-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Load data</span></span>
<span id="cb11-2"><a href="reproducible-research.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  db_gh <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;files/COVID_article/inputdata.csv&quot;</span>)</span>
<span id="cb11-3"><a href="reproducible-research.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="reproducible-research.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="reproducible-research.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Aggregate data ############################################################</span></span>
<span id="cb11-6"><a href="reproducible-research.html#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="reproducible-research.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter date</span></span>
<span id="cb11-8"><a href="reproducible-research.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  db_gh<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(db_gh<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb11-9"><a href="reproducible-research.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span><span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%y&quot;</span>))</span>
<span id="cb11-10"><a href="reproducible-research.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-11"><a href="reproducible-research.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set New York as &quot;country&quot; (easier handling)</span></span>
<span id="cb11-12"><a href="reproducible-research.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  db_gh2<span class="sc">$</span>Country[db_gh2<span class="sc">$</span>Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span> <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Region <span class="sc">==</span> <span class="st">&quot;NYC&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NYC&quot;</span></span>
<span id="cb11-13"><a href="reproducible-research.html#cb11-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-14"><a href="reproducible-research.html#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum data over age groups</span></span>
<span id="cb11-15"><a href="reproducible-research.html#cb11-15" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span> </span>
<span id="cb11-16"><a href="reproducible-research.html#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;USA&quot;</span>,<span class="st">&quot;South Korea&quot;</span>) <span class="sc">&amp;</span> Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-17"><a href="reproducible-research.html#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country, Code,Date) <span class="sc">%&gt;%</span> </span>
<span id="cb11-18"><a href="reproducible-research.html#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Cases =</span> <span class="fu">sum</span>(Cases),</span>
<span id="cb11-19"><a href="reproducible-research.html#cb11-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">Deaths =</span> <span class="fu">sum</span>(Deaths))</span>
<span id="cb11-20"><a href="reproducible-research.html#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="reproducible-research.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude bolletino </span></span>
<span id="cb11-22"><a href="reproducible-research.html#cb11-22" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="reproducible-research.html#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">str_sub</span>(Code, <span class="dv">1</span>, <span class="dv">5</span>) <span class="sc">!=</span> <span class="st">&quot;ITbol&quot;</span>)</span>
<span id="cb11-24"><a href="reproducible-research.html#cb11-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-25"><a href="reproducible-research.html#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by date</span></span>
<span id="cb11-26"><a href="reproducible-research.html#cb11-26" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb11-27"><a href="reproducible-research.html#cb11-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-28"><a href="reproducible-research.html#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smooth reporting issues cases</span></span>
<span id="cb11-29"><a href="reproducible-research.html#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(country <span class="cf">in</span> <span class="fu">unique</span>(db_gh2<span class="sc">$</span>Country)) {</span>
<span id="cb11-30"><a href="reproducible-research.html#cb11-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-31"><a href="reproducible-research.html#cb11-31" aria-hidden="true" tabindex="-1"></a>    days <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Date[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country]</span>
<span id="cb11-32"><a href="reproducible-research.html#cb11-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-33"><a href="reproducible-research.html#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(days)) {</span>
<span id="cb11-34"><a href="reproducible-research.html#cb11-34" aria-hidden="true" tabindex="-1"></a>      current <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]]</span>
<span id="cb11-35"><a href="reproducible-research.html#cb11-35" aria-hidden="true" tabindex="-1"></a>      previous <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day<span class="dv">-1</span>]]</span>
<span id="cb11-36"><a href="reproducible-research.html#cb11-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-37"><a href="reproducible-research.html#cb11-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(current<span class="sc">&lt;</span>previous) db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]] <span class="ot">&lt;-</span> previous</span>
<span id="cb11-38"><a href="reproducible-research.html#cb11-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-39"><a href="reproducible-research.html#cb11-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-40"><a href="reproducible-research.html#cb11-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-41"><a href="reproducible-research.html#cb11-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-42"><a href="reproducible-research.html#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="reproducible-research.html#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smooth reporting issues deaths</span></span>
<span id="cb11-44"><a href="reproducible-research.html#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(country <span class="cf">in</span> <span class="fu">unique</span>(db_gh2<span class="sc">$</span>Country)) {</span>
<span id="cb11-45"><a href="reproducible-research.html#cb11-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-46"><a href="reproducible-research.html#cb11-46" aria-hidden="true" tabindex="-1"></a>    days <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Date[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country]</span>
<span id="cb11-47"><a href="reproducible-research.html#cb11-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-48"><a href="reproducible-research.html#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(days)) {</span>
<span id="cb11-49"><a href="reproducible-research.html#cb11-49" aria-hidden="true" tabindex="-1"></a>      current <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]]</span>
<span id="cb11-50"><a href="reproducible-research.html#cb11-50" aria-hidden="true" tabindex="-1"></a>      previous <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day<span class="dv">-1</span>]]</span>
<span id="cb11-51"><a href="reproducible-research.html#cb11-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-52"><a href="reproducible-research.html#cb11-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(current<span class="sc">&lt;</span>previous) db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]] <span class="ot">&lt;-</span> previous</span>
<span id="cb11-53"><a href="reproducible-research.html#cb11-53" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-54"><a href="reproducible-research.html#cb11-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-55"><a href="reproducible-research.html#cb11-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-56"><a href="reproducible-research.html#cb11-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-57"><a href="reproducible-research.html#cb11-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-58"><a href="reproducible-research.html#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="reproducible-research.html#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot settings #############################################################</span></span>
<span id="cb11-60"><a href="reproducible-research.html#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="reproducible-research.html#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set colors</span></span>
<span id="cb11-62"><a href="reproducible-research.html#cb11-62" aria-hidden="true" tabindex="-1"></a>  col_country <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Germany&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb11-63"><a href="reproducible-research.html#cb11-63" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Italy&quot;</span> <span class="ot">=</span> <span class="st">&quot;#2ca25f&quot;</span>,</span>
<span id="cb11-64"><a href="reproducible-research.html#cb11-64" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;NYC&quot;</span><span class="ot">=</span><span class="st">&quot;#f0027f&quot;</span>,</span>
<span id="cb11-65"><a href="reproducible-research.html#cb11-65" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Spain&quot;</span><span class="ot">=</span><span class="st">&quot;#beaed4&quot;</span>,</span>
<span id="cb11-66"><a href="reproducible-research.html#cb11-66" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;South Korea&quot;</span><span class="ot">=</span><span class="st">&quot;#fdc086&quot;</span>)<span class="co">#,</span></span>
<span id="cb11-67"><a href="reproducible-research.html#cb11-67" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#&quot;USA&quot;=&quot;#386cb0&quot;)</span></span>
<span id="cb11-68"><a href="reproducible-research.html#cb11-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-69"><a href="reproducible-research.html#cb11-69" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,</span>
<span id="cb11-70"><a href="reproducible-research.html#cb11-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#2ca25f&quot;</span>,</span>
<span id="cb11-71"><a href="reproducible-research.html#cb11-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#f0027f&quot;</span>,</span>
<span id="cb11-72"><a href="reproducible-research.html#cb11-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#beaed4&quot;</span>,</span>
<span id="cb11-73"><a href="reproducible-research.html#cb11-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#fdc086&quot;</span>)<span class="co">#,</span></span>
<span id="cb11-74"><a href="reproducible-research.html#cb11-74" aria-hidden="true" tabindex="-1"></a>            <span class="co">#&quot;#386cb0&quot;)</span></span>
<span id="cb11-75"><a href="reproducible-research.html#cb11-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-76"><a href="reproducible-research.html#cb11-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-77"><a href="reproducible-research.html#cb11-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis</span></span>
<span id="cb11-78"><a href="reproducible-research.html#cb11-78" aria-hidden="true" tabindex="-1"></a>  labs <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span></span>
<span id="cb11-79"><a href="reproducible-research.html#cb11-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> </span>
<span id="cb11-80"><a href="reproducible-research.html#cb11-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Cases <span class="sc">==</span> <span class="fu">max</span>(Cases)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-81"><a href="reproducible-research.html#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Cases =</span> Cases <span class="sc">+</span> <span class="dv">3000</span>)</span>
<span id="cb11-82"><a href="reproducible-research.html#cb11-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-83"><a href="reproducible-research.html#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Including all reports</span></span>
<span id="cb11-84"><a href="reproducible-research.html#cb11-84" aria-hidden="true" tabindex="-1"></a>  tx <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb11-85"><a href="reproducible-research.html#cb11-85" aria-hidden="true" tabindex="-1"></a>  lim_x <span class="ot">&lt;-</span> <span class="dv">240000</span></span>
<span id="cb11-86"><a href="reproducible-research.html#cb11-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-87"><a href="reproducible-research.html#cb11-87" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot ######################################################################</span></span>
<span id="cb11-88"><a href="reproducible-research.html#cb11-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-89"><a href="reproducible-research.html#cb11-89" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="sc">%&gt;%</span> </span>
<span id="cb11-90"><a href="reproducible-research.html#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Cases, Deaths, <span class="at">col =</span> Country))<span class="sc">+</span></span>
<span id="cb11-91"><a href="reproducible-research.html#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb11-92"><a href="reproducible-research.html#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">300000</span>, <span class="dv">50000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, lim_x <span class="sc">+</span> <span class="dv">30000</span>), <span class="at">labels =</span> comma)<span class="sc">+</span></span>
<span id="cb11-93"><a href="reproducible-research.html#cb11-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">5000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40000</span>), <span class="at">labels =</span> comma)<span class="sc">+</span></span>
<span id="cb11-94"><a href="reproducible-research.html#cb11-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">02</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb11-95"><a href="reproducible-research.html#cb11-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">05</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb11-96"><a href="reproducible-research.html#cb11-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">10</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb11-97"><a href="reproducible-research.html#cb11-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">15</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb11-98"><a href="reproducible-research.html#cb11-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;2% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">02</span>,</span>
<span id="cb11-99"><a href="reproducible-research.html#cb11-99" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb11-100"><a href="reproducible-research.html#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;5% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">05</span>,</span>
<span id="cb11-101"><a href="reproducible-research.html#cb11-101" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb11-102"><a href="reproducible-research.html#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;10% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">10</span>,</span>
<span id="cb11-103"><a href="reproducible-research.html#cb11-103" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb11-104"><a href="reproducible-research.html#cb11-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;15% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">15</span>,</span>
<span id="cb11-105"><a href="reproducible-research.html#cb11-105" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb11-106"><a href="reproducible-research.html#cb11-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> cols)<span class="sc">+</span></span>
<span id="cb11-107"><a href="reproducible-research.html#cb11-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> labs, <span class="fu">aes</span>(Cases, Deaths, <span class="at">label =</span> Country),</span>
<span id="cb11-108"><a href="reproducible-research.html#cb11-108" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-109"><a href="reproducible-research.html#cb11-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb11-110"><a href="reproducible-research.html#cb11-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>, </span>
<span id="cb11-111"><a href="reproducible-research.html#cb11-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Deaths&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-112"><a href="reproducible-research.html#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-113"><a href="reproducible-research.html#cb11-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-114"><a href="reproducible-research.html#cb11-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb11-115"><a href="reproducible-research.html#cb11-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;mm&quot;</span>),</span>
<span id="cb11-116"><a href="reproducible-research.html#cb11-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx),</span>
<span id="cb11-117"><a href="reproducible-research.html#cb11-117" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx),</span>
<span id="cb11-118"><a href="reproducible-research.html#cb11-118" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb11-119"><a href="reproducible-research.html#cb11-119" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb11-120"><a href="reproducible-research.html#cb11-120" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="portfolio_book_files/figure-html/line%20graph-1.png" width="672" /></p>
<p><em>Figure 3: Differences in Case fatality rate between countries.</em></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="reproducible-research.html#cb12-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save</span></span>
<span id="cb12-2"><a href="reproducible-research.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;files/COVID_article/Fig_1.jpg&quot;</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-management.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
